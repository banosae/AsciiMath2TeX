<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Human → LaTeX (Overleaf) Converter</title>

  <!-- MathJax (render preview) -->
  <script>
    // MathJax v4: dynamic typeset 하려고 typeset은 수동으로 호출
    window.MathJax = {
      startup: { typeset: false },
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']]
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-chtml.js"></script>
  <!-- MathJax CDN 안내: 공식 문서 예시 참고 -->
  <!-- https://docs.mathjax.org/en/v4.0/web/start.html -->

  <!-- math.js (parse -> toTex) -->
  <script defer src="https://cdn.jsdelivr.net/npm/mathjs@11/lib/browser/math.js"></script>

  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; background: #0b0f19; color: #e7eaf3; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 20px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .card { background: #121a2a; border: 1px solid #22304a; border-radius: 14px; padding: 14px; }
    textarea { width: 100%; min-height: 110px; resize: vertical; border-radius: 12px; border: 1px solid #2a3b5d; background: #0f1626; color: #e7eaf3; padding: 12px; box-sizing: border-box; font-size: 14px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 10px; }
    select, button, input { border-radius: 10px; border: 1px solid #2a3b5d; background: #0f1626; color: #e7eaf3; padding: 10px 12px; }
    button { cursor: pointer; }
    button.primary { background: #2b5cff; border-color: #2b5cff; }
    .out { width: 100%; min-height: 110px; border-radius: 12px; border: 1px solid #2a3b5d; background: #0f1626; padding: 12px; box-sizing: border-box; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 13px; }
    .muted { color: #a9b2c7; font-size: 12px; margin-top: 8px; line-height: 1.4; }
    .err { color: #ff7a7a; font-size: 12px; margin-top: 8px; white-space: pre-wrap; }
    .preview { padding: 14px; min-height: 70px; background: #0f1626; border: 1px dashed #2a3b5d; border-radius: 12px; }
    .badge { display:inline-block; font-size: 12px; padding: 4px 8px; border-radius: 999px; border:1px solid #2a3b5d; background:#0f1626; color:#a9b2c7; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Human → LaTeX (Overleaf) 변환기 <span class="badge">MVP</span></h1>

    <div class="card">
      <div class="muted">
        입력 예시: <code>2x^2 + 3y</code>, <code>sqrt(2/3)</code>, <code>(x^2+y^2=z^2)</code> 등<br/>
        변환은 math.js의 <code>parse()</code> → <code>toTex()</code>로 LaTeX를 만들고, 미리보기는 MathJax로 렌더링함. :contentReference[oaicite:3]{index=3}
      </div>

      <h2 style="font-size:14px;margin:12px 0 8px;">입력</h2>
      <textarea id="inp" placeholder="예: 2x^2 + 3y = z"></textarea>

      <div class="row">
        <label class="muted">출력 포맷</label>
        <select id="fmt">
          <option value="inline">Inline: \( ... \)</option>
          <option value="display" selected>Display: \[ ... \]</option>
          <option value="equation">equation 환경</option>
          <option value="align">align 환경(= 기준 정렬)</option>
        </select>

        <button class="primary" id="btn">변환</button>
        <button id="copy">LaTeX 복사</button>
        <button id="ex">예시 넣기</button>
      </div>

      <div id="err" class="err"></div>

      <h2 style="font-size:14px;margin:12px 0 8px;">LaTeX 출력</h2>
      <div class="out" id="out"></div>

      <h2 style="font-size:14px;margin:12px 0 8px;">미리보기</h2>
      <div class="preview" id="preview"></div>

      <div class="muted">
        Overleaf에서는 보통 <code>\(...\)</code>, <code>\[...\]</code>, <code>\begin{equation}...\end{equation}</code> 같은 수식 문법을 그대로 쓰면 됨. :contentReference[oaicite:4]{index=4}
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function preprocess(s) {
    // “사람 친화적” 입력을 약간만 정리
    // (원하면 여기 룰을 계속 추가하면서 차별화하면 됨)
    return s
      .trim()
      .replaceAll('π', 'pi')
      .replaceAll('×', '*')
      .replaceAll('·', '*')
      .replaceAll('−', '-')  // 유니코드 마이너스
      .replace(/\s+/g, ' ');
  }

  function splitEquation(s) {
    // 단순 '='만 equation으로 처리 (<=, >=, == 는 건드리지 않음)
    const idx = s.indexOf('=');
    if (idx === -1) return null;
    if (s.includes('<=') || s.includes('>=') || s.includes('==')) return null;
    const left = s.slice(0, idx).trim();
    const right = s.slice(idx + 1).trim();
    if (!left || !right) return null;
    return { left, right };
  }

  function toTexExpr(expr) {
    // math.js로 파싱 후 toTex
    const node = math.parse(expr);
    return node.toTex();
  }

  function buildLatex(input, fmt) {
    const s = preprocess(input);
    if (!s) throw new Error('빈 입력입니다.');

    const eq = splitEquation(s);
    let body;

    if (eq) {
      const L = toTexExpr(eq.left);
      const R = toTexExpr(eq.right);
      if (fmt === 'align') {
        // align: "=" 기준으로 & 정렬
        return [
          "\\begin{align}",
          `  ${L} &= ${R} \\\\`,
          "\\end{align}"
        ].join("\n");
      } else {
        body = `${L} = ${R}`;
      }
    } else {
      body = toTexExpr(s);
    }

    if (fmt === 'inline') return `\\(${body}\\)`;
    if (fmt === 'equation') return `\\begin{equation}\n${body}\n\\end{equation}`;
    // default display
    return `\\[${body}\\]`;
  }

  async function typesetPreview(latex) {
    const el = $('preview');
    el.textContent = latex; // MathJax가 delimiter 찾아 렌더
    if (window.MathJax?.typesetPromise) {
      await MathJax.typesetPromise([el]);
    }
  }

  $('btn').addEventListener('click', async () => {
    $('err').textContent = '';
    try {
      if (!window.math) throw new Error('math.js 로딩이 아직 안 됐습니다. 새로고침 후 다시 시도해 주세요.');
      const fmt = $('fmt').value;
      const latex = buildLatex($('inp').value, fmt);
      $('out').textContent = latex;
      await typesetPreview(latex);
    } catch (e) {
      $('err').textContent = String(e?.message || e);
    }
  });

  $('copy').addEventListener('click', async () => {
    const text = $('out').textContent || '';
    if (!text) return;
    await navigator.clipboard.writeText(text);
    $('copy').textContent = '복사됨!';
    setTimeout(() => $('copy').textContent = 'LaTeX 복사', 900);
  });

  $('ex').addEventListener('click', () => {
    const samples = [
      "2x^2 + 3y",
      "sqrt(2/3)",
      "(x^2 + y^2 = z^2)",
      "sin(x)^2 + cos(x)^2 = 1",
      "1/(1+exp(-x))"
    ];
    $('inp').value = samples[Math.floor(Math.random() * samples.length)];
  });
</script>
</body>
</html>
